<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">



    <ui:composition template="/plantillas/PlantillaGestionDocumental.xhtml">
        <ui:define name="content">
            <h:body>

                <h:form id="IngresarModal">

                    #{Documento.nuevoDocumentoObjeto()}                        

                    <p:panelGrid style="margin-top: 20px" styleClass="table table-bordered" columns="4" id="datos">


                        <h:outputText value="Título del Documento"></h:outputText>
                        <p:inputText id="nombre" required="true" label="nombre del Documento" value="#{Documento.objetoDocumentoInsercion.tituloDocumento}"/>

                        <h:outputText value="Tipo Documental del Documento"></h:outputText>                            
                        <p:selectOneMenu id="desplegableIngresarTipoD" value="#{Documento.objetoDocumentoInsercion.tipoDocumentalDocumento.idTipoDocumental}" style="width: 150px;">
                            <p:ajax listener="#{Documento.traeConsecutivo()}" update="version"/>
                            <f:selectItem itemLabel="Selecione Tipo Documento" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{ListaAdministracionBean.listaTipoDocumento}"/>
                        </p:selectOneMenu>

                        <h:outputText value="Plantilla del Documento"></h:outputText>
                        <p:selectOneMenu label="Plantilla" required="true" id="desplegableIngresarPlantilla" value="#{Documento.objetoDocumentoInsercion.plantilla.idPlantilla}" style="width: 150px;">
                            <f:selectItem itemLabel="Selecione la Plantilla del Documento" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{ListaAdministracionBean.listaPlantillas}"/>
                        </p:selectOneMenu>

                        <h:outputText value="Version del Documento"></h:outputText>
                        <p:inputMask required="true" id="version" label="nombre del Documento" value="#{Documento.objetoDocumentoInsercion.versionDocumento}" mask="#{Documento.consecutivo}-0000" maxlength="4"/>


                        <h:outputText value="Estado del Documento"></h:outputText>
                        <p:selectOneMenu id="desplegableIngresarEstado" value="#{Documento.objetoDocumentoInsercion.estadoDocumento}" style="width: 150px;">                            
                            <f:selectItem itemLabel="Selecione Estado" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{ListaAdministracionBean.listaEstados}"/>
                        </p:selectOneMenu>

                        <h:outputText value="Empresa"></h:outputText>
                        <p:selectOneMenu id="desplegableIngresarEmpresa" value="#{Documento.objetoDocumentoInsercion.empresaDocumento.idEmpresa}" style="width: 150px;">
                            <f:selectItem itemLabel="Selecione una Empresa" itemValue="#{-1}" noSelectionOption="true"/>
                            <f:selectItems value="#{ListaAdministracionBean.listaEmpresas}"/>
                        </p:selectOneMenu> 

                        <ui:repeat var="nivel" value="#{Nivel.lista}">     
                            <p:spacer width="50"/>
                            <p:row>
                                <h:outputText value="#{nivel.nombreNivel}"/><br/>
                                <p:selectOneMenu id="desplegable#{nivel.nombreNivel}" value="#{Documento.objetoDocumentoInsercion.macroProcesoDocumento.idMacroproceso}" style="width: 150px;">
                                    <p:ajax listener="#{ListaAdministracionBean.idMacrio(Documento.objetoDocumentoInsercion.macroProcesoDocumento.idMacroproceso)}" update=":IngresarModal:desplegableIngresarProceso"/>
                                    <f:selectItem itemLabel="Selecione Macro Proceso" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{ListaAdministracionBean.listaMacroProcesos}"/>
                                </p:selectOneMenu>
                            </p:row>
              
                        </ui:repeat>

                        <h:outputText value="MacroProceso del Documento"></h:outputText>
                        <p:selectOneMenu id="desplegableIngresarMacro" value="#{Documento.objetoDocumentoInsercion.macroProcesoDocumento.idMacroproceso}" style="width: 150px;">
                            <p:ajax listener="#{ListaAdministracionBean.idMacrio(Documento.objetoDocumentoInsercion.macroProcesoDocumento.idMacroproceso)}" update=":IngresarModal:desplegableIngresarProceso"/>
                            <f:selectItem itemLabel="Selecione Macro Proceso" itemValue="" noSelectionOption="true"/>
                            <f:selectItems value="#{ListaAdministracionBean.listaMacroProcesos}"/>
                        </p:selectOneMenu>

                        <h:outputText value="Proceso del Documento"></h:outputText>
                        <p:selectOneMenu id="desplegableIngresarProceso" value="#{Documento.objetoDocumentoInsercion.procesoProcesoDocumento.idProcesos}" style="width: 150px;">
                            <p:ajax listener="#{ListaAdministracionBean.idCambiaProceso(Documento.objetoDocumentoInsercion.procesoProcesoDocumento.idProcesos)}" update=":IngresarModal:desplegableIngresarSubproceso"/>
                            <f:selectItem itemLabel="Selecione Proceso" itemValue="#{-1}" noSelectionOption="true"/>
                            <f:selectItems value="#{ListaAdministracionBean.listaProcesos}"/>
                        </p:selectOneMenu>

                        <h:outputText value="SubProceso del Documento"></h:outputText>
                        <p:selectOneMenu id="desplegableIngresarSubproceso" value="#{Documento.objetoDocumentoInsercion.subProcesoProcesoDocumento.idSubproceso}" style="width: 150px;">
                            <f:selectItem itemLabel="Selecione un SubProceso" itemValue="#{-1}" noSelectionOption="true"/>
                            <f:selectItems value="#{ListaAdministracionBean.listaSubProcesos}"/>
                        </p:selectOneMenu>   


                    </p:panelGrid>    
                    <h:outputText value="Selecione un Proceso"/>
                    <p:tree value="#{Documento.raiz}" var="nodo" selection="#{Documento.arbolaux}" selectionMode="single" required="true" id="Proceso">
                        <p:treeNode>
                            <h:outputText value="#{nodo.nombreProceso}"/>
                        </p:treeNode>
                    </p:tree>
                    <p:commandButton value="Asignar Usuarios" update=":IngresarModal:asignados" process="@this,nombre,desplegableIngresarPlantilla,Proceso,version" actionListener="#{Documento.evalua(Documento.arbolaux)}" class="botonNormal" />

                    <p:panelGrid class="TABLA" id="asignados">
                        <f:facet name="header">
                            <p:row>
                                <p:column colspan="5">Plan de trabajo para la Elaboración del Documento</p:column>
                            </p:row>
                            <p:row>
                                <p:column></p:column>
                                <p:column>Hasta</p:column>
                                <p:column>Fecha</p:column>

                            </p:row>
                        </f:facet>
                        <ui:repeat value="#{Documento.usuarioAccionProcesoEntity}" var="acciones2">
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{acciones2.accion.nombreAccion}"/>
                                </p:column>      
                                <p:column>
                                    <p:pickList label="Grupos de Usuarios" id="listausuarioProceso" value="#{acciones2.seleccionDual}" var="usupro" itemLabel="#{usupro}" itemValue="#{usupro}" required="true">
                                        <f:facet name="sourceCaption">Usuarios disponibles</f:facet>
                                        <f:facet name="targetCaption">Usuarios de la Acción</f:facet>
                                    </p:pickList>                                    
                                </p:column>
                                <p:column>
                                    <div class="container">
                                        <div class="row">
                                            <div class='col-sm-6'>
                                                <div class="form-group">
                                                    <div class='input-group date' id='datetimepicker#{acciones2.accion.idAccion}'>
                                                        <p:inputText class="form-control" value="#{acciones2.fechaLimite}"/>                                                        
                                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <script type="text/javascript">
                                                $(function () {
                                                    $('#datetimepicker#{acciones2.accion.idAccion}').datetimepicker({
                                                        locale: 'es'
                                                    });
                                                });
                                            </script>
                                        </div>
                                    </div>
                                                                                                                        <!--<p:calendar label="Fecha Límite" id="multi" value="#{acciones2.fechaLimite}" pages="3" pattern="dd.MM.yyyy"></p:calendar>-->

                                </p:column>
                            </p:row>
                        </ui:repeat>
                    </p:panelGrid>

                    <p:commandButton id="Ingresar" value="Ingresar" update=":DocumentoForm:tablaDocumento,:IngresarModal:asignados" actionListener="#{Documento.instertarDocumento()}" validateClient="true" class="botonNormal" ajax="false"/>

                </h:form>             
            </h:body>
        </ui:define>
    </ui:composition>
</html>